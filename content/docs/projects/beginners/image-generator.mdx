---
title: "AI图像生成器"
description: "构建一个简单的AI图像生成应用"
---

# AI图像生成器

在本教程中，我们将构建一个简单但功能强大的AI图像生成应用。用户可以输入文本提示，应用将使用AI API生成相应的图像。这是一个很好的项目，可以学习如何与外部API交互，处理异步操作，以及创建一个现代化的用户界面。

## 项目概述

- **预计完成时间**：4-5小时
- **难度级别**：初级到中级
- **前提条件**：
  - 基本的HTML、CSS和JavaScript知识
  - 了解异步JavaScript（Promises, async/await）
  - Node.js基础知识
- **项目目标**：创建一个可以根据文本提示生成图像的Web应用

## 学习成果

完成本教程后，你将能够：
- 设置和使用第三方API
- 处理API密钥和环境变量
- 实现加载状态和错误处理
- 创建响应式用户界面
- 使用现代JavaScript处理异步操作
- 部署Web应用到生产环境

## 功能特性

我们的AI图像生成器将包含以下功能：
- 文本提示输入界面
- 图像大小和样式选项
- 生成按钮和加载指示器
- 图像展示区域
- 图像下载功能
- 生成历史记录
- 响应式设计，适用于移动设备和桌面

## 开发环境

### 推荐工具
- **代码编辑器**：Visual Studio Code或Cursor
- **浏览器**：Chrome、Firefox或Edge
- **包管理器**：pnpm（我们将使用它来管理依赖）
- **API**：我们将使用OpenAI的DALL-E API或Stability AI的API

### 项目结构

```
ai-image-generator/
├── public/
│   ├── favicon.ico
│   └── images/
├── src/
│   ├── components/
│   │   ├── Header.jsx
│   │   ├── PromptForm.jsx
│   │   ├── ImageDisplay.jsx
│   │   ├── LoadingSpinner.jsx
│   │   └── HistoryPanel.jsx
│   ├── services/
│   │   └── api.js
│   ├── styles/
│   │   ├── global.css
│   │   └── components.css
│   ├── utils/
│   │   └── helpers.js
│   ├── App.jsx
│   └── main.jsx
├── .env
├── .gitignore
├── index.html
├── package.json
└── README.md
```

## 第一步：设置项目

首先，我们需要创建一个新的React项目。我们将使用Vite，这是一个现代的前端构建工具，它提供了更快的开发体验。

1. 打开终端，创建一个新的Vite项目：

```bash
pnpm create vite ai-image-generator --template react
cd ai-image-generator
pnpm install
```

2. 安装必要的依赖：

```bash
pnpm add axios react-router-dom styled-components
```

3. 创建一个`.env`文件来存储API密钥（不要将实际密钥提交到版本控制系统）：

```
VITE_API_KEY=your_api_key_here
VITE_API_URL=https://api.openai.com/v1/images/generations
```

4. 更新`.gitignore`文件以排除`.env`文件：

```
# 其他内容...
.env
.env.local
.env.development.local
.env.test.local
.env.production.local
```

## 第二步：创建基本组件

让我们开始创建应用程序的基本组件。首先，我们将设置主要的App组件和全局样式。

1. 更新`src/App.jsx`：

```jsx
import { useState } from 'react';
import Header from './components/Header';
import PromptForm from './components/PromptForm';
import ImageDisplay from './components/ImageDisplay';
import HistoryPanel from './components/HistoryPanel';
import './styles/global.css';

function App() {
  const [generatedImage, setGeneratedImage] = useState(null);
  const [isLoading, setIsLoading] = useState(false);
  const [error, setError] = useState(null);
  const [history, setHistory] = useState([]);

  const handleImageGeneration = (imageData) => {
    setGeneratedImage(imageData);
    setHistory([imageData, ...history].slice(0, 10)); // Keep only the last 10 images
  };

  return (
    <div className="app-container">
      <Header />
      <main className="main-content">
        <div className="generator-section">
          <PromptForm 
            setGeneratedImage={handleImageGeneration}
            setIsLoading={setIsLoading}
            setError={setError}
          />
          <ImageDisplay 
            generatedImage={generatedImage}
            isLoading={isLoading}
            error={error}
          />
        </div>
        <HistoryPanel history={history} setGeneratedImage={setGeneratedImage} />
      </main>
    </div>
  );
}

export default App;
```

2. 创建`src/styles/global.css`：

```css
:root {
  --primary-color: #6366f1;
  --secondary-color: #8b5cf6;
  --background-color: #f9fafb;
  --card-background: #ffffff;
  --text-color: #1f2937;
  --border-color: #e5e7eb;
  --success-color: #10b981;
  --error-color: #ef4444;
  --border-radius: 8px;
  --shadow: 0 4px 6px -1px rgba(0, 0, 0, 0.1), 0 2px 4px -1px rgba(0, 0, 0, 0.06);
}

* {
  box-sizing: border-box;
  margin: 0;
  padding: 0;
}

body {
  font-family: 'Inter', -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, Oxygen,
    Ubuntu, Cantarell, 'Open Sans', 'Helvetica Neue', sans-serif;
  background-color: var(--background-color);
  color: var(--text-color);
  line-height: 1.5;
}

.app-container {
  max-width: 1200px;
  margin: 0 auto;
  padding: 2rem 1rem;
}

.main-content {
  display: grid;
  grid-template-columns: 1fr 300px;
  gap: 2rem;
  margin-top: 2rem;
}

.generator-section {
  display: flex;
  flex-direction: column;
  gap: 2rem;
}

button {
  cursor: pointer;
  background-color: var(--primary-color);
  color: white;
  border: none;
  padding: 0.75rem 1.5rem;
  border-radius: var(--border-radius);
  font-weight: 600;
  transition: background-color 0.2s;
}

button:hover {
  background-color: var(--secondary-color);
}

button:disabled {
  background-color: var(--border-color);
  cursor: not-allowed;
}

input, select, textarea {
  width: 100%;
  padding: 0.75rem;
  border: 1px solid var(--border-color);
  border-radius: var(--border-radius);
  font-size: 1rem;
  transition: border-color 0.2s;
}

input:focus, select:focus, textarea:focus {
  outline: none;
  border-color: var(--primary-color);
}

.card {
  background-color: var(--card-background);
  border-radius: var(--border-radius);
  box-shadow: var(--shadow);
  padding: 1.5rem;
}

@media (max-width: 768px) {
  .main-content {
    grid-template-columns: 1fr;
  }
}
```

## 第三步：创建组件

现在，让我们创建应用程序的各个组件。

1. 创建`src/components/Header.jsx`：

```jsx
function Header() {
  return (
    <header className="header">
      <h1>AI图像生成器</h1>
      <p>输入文本提示，生成AI创建的图像</p>
    </header>
  );
}

export default Header;
```

2. 创建`src/components/LoadingSpinner.jsx`：

```jsx
import '../styles/components.css';

function LoadingSpinner() {
  return (
    <div className="spinner-container">
      <div className="spinner"></div>
      <p>生成图像中...</p>
    </div>
  );
}

export default LoadingSpinner;
```

3. 创建`src/components/ImageDisplay.jsx`：

```jsx
import LoadingSpinner from './LoadingSpinner';

function ImageDisplay({ generatedImage, isLoading, error }) {
  const handleDownload = () => {
    if (!generatedImage) return;
    
    // Create a temporary link element
    const link = document.createElement('a');
    link.href = generatedImage.url;
    link.download = `ai-image-${Date.now()}.png`;
    document.body.appendChild(link);
    link.click();
    document.body.removeChild(link);
  };

  return (
    <div className="card image-display">
      {error && (
        <div className="error-message">
          <p>生成图像时出错：{error}</p>
        </div>
      )}
      
      {isLoading ? (
        <LoadingSpinner />
      ) : generatedImage ? (
        <div className="generated-image-container">
          <img 
            src={generatedImage.url} 
            alt={generatedImage.prompt} 
            className="generated-image" 
          />
          <div className="image-actions">
            <button onClick={handleDownload} className="download-button">
              下载图像
            </button>
          </div>
          <div className="image-prompt">
            <p><strong>提示:</strong> {generatedImage.prompt}</p>
          </div>
        </div>
      ) : (
        <div className="empty-state">
          <p>输入提示并点击"生成"按钮来创建图像</p>
        </div>
      )}
    </div>
  );
}

export default ImageDisplay;
```

4. 创建`src/components/PromptForm.jsx`：

```jsx
import { useState } from 'react';
import { generateImage } from '../services/api';

function PromptForm({ setGeneratedImage, setIsLoading, setError }) {
  const [prompt, setPrompt] = useState('');
  const [size, setSize] = useState('512x512');
  const [style, setStyle] = useState('vivid');

  const handleSubmit = async (e) => {
    e.preventDefault();
    
    if (!prompt.trim()) {
      setError('请输入提示文本');
      return;
    }
    
    setIsLoading(true);
    setError(null);
    
    try {
      const imageData = await generateImage(prompt, size, style);
      setGeneratedImage({
        url: imageData.url,
        prompt,
        size,
        style,
        timestamp: new Date().toISOString()
      });
    } catch (err) {
      setError(err.message || '生成图像时出错');
      console.error('Error generating image:', err);
    } finally {
      setIsLoading(false);
    }
  };

  return (
    <div className="card prompt-form-container">
      <form onSubmit={handleSubmit} className="prompt-form">
        <div className="form-group">
          <label htmlFor="prompt">图像描述</label>
          <textarea
            id="prompt"
            value={prompt}
            onChange={(e) => setPrompt(e.target.value)}
            placeholder="描述你想要生成的图像，例如：'一只在月光下嚎叫的狼'"
            rows={3}
            required
          />
        </div>
        
        <div className="form-row">
          <div className="form-group">
            <label htmlFor="size">图像尺寸</label>
            <select
              id="size"
              value={size}
              onChange={(e) => setSize(e.target.value)}
            >
              <option value="256x256">小 (256x256)</option>
              <option value="512x512">中 (512x512)</option>
              <option value="1024x1024">大 (1024x1024)</option>
            </select>
          </div>
          
          <div className="form-group">
            <label htmlFor="style">图像风格</label>
            <select
              id="style"
              value={style}
              onChange={(e) => setStyle(e.target.value)}
            >
              <option value="vivid">生动</option>
              <option value="natural">自然</option>
            </select>
          </div>
        </div>
        
        <button type="submit" className="generate-button">
          生成图像
        </button>
      </form>
    </div>
  );
}

export default PromptForm;
```

5. 创建`src/components/HistoryPanel.jsx`：

```jsx
function HistoryPanel({ history, setGeneratedImage }) {
  if (history.length === 0) {
    return (
      <div className="card history-panel">
        <h2>生成历史</h2>
        <p className="empty-history">暂无生成历史</p>
      </div>
    );
  }

  return (
    <div className="card history-panel">
      <h2>生成历史</h2>
      <div className="history-list">
        {history.map((item, index) => (
          <div 
            key={index} 
            className="history-item"
            onClick={() => setGeneratedImage(item)}
          >
            <img 
              src={item.url} 
              alt={item.prompt} 
              className="history-thumbnail" 
            />
            <div className="history-item-details">
              <p className="history-prompt">{item.prompt.substring(0, 30)}...</p>
              <p className="history-timestamp">
                {new Date(item.timestamp).toLocaleString()}
              </p>
            </div>
          </div>
        ))}
      </div>
    </div>
  );
}

export default HistoryPanel;
```

6. 创建`src/styles/components.css`：

```css
/* Header Styles */
.header {
  text-align: center;
  margin-bottom: 2rem;
}

.header h1 {
  color: var(--primary-color);
  font-size: 2.5rem;
  margin-bottom: 0.5rem;
}

.header p {
  color: var(--text-color);
  font-size: 1.1rem;
  opacity: 0.8;
}

/* Prompt Form Styles */
.prompt-form-container {
  margin-bottom: 1rem;
}

.prompt-form {
  display: flex;
  flex-direction: column;
  gap: 1.5rem;
}

.form-group {
  display: flex;
  flex-direction: column;
  gap: 0.5rem;
}

.form-row {
  display: grid;
  grid-template-columns: 1fr 1fr;
  gap: 1rem;
}

.generate-button {
  margin-top: 0.5rem;
  font-size: 1.1rem;
  padding: 0.75rem 1.5rem;
}

/* Image Display Styles */
.image-display {
  min-height: 400px;
  display: flex;
  flex-direction: column;
  justify-content: center;
  align-items: center;
}

.empty-state {
  text-align: center;
  color: #6b7280;
  padding: 2rem;
}

.generated-image-container {
  width: 100%;
  display: flex;
  flex-direction: column;
  align-items: center;
  gap: 1rem;
}

.generated-image {
  max-width: 100%;
  max-height: 500px;
  border-radius: var(--border-radius);
  box-shadow: var(--shadow);
}

.image-actions {
  display: flex;
  gap: 1rem;
  margin-top: 1rem;
}

.image-prompt {
  width: 100%;
  margin-top: 1rem;
  padding: 1rem;
  background-color: #f3f4f6;
  border-radius: var(--border-radius);
}

/* Loading Spinner Styles */
.spinner-container {
  display: flex;
  flex-direction: column;
  align-items: center;
  justify-content: center;
  gap: 1rem;
  padding: 2rem;
}

.spinner {
  width: 50px;
  height: 50px;
  border: 5px solid rgba(0, 0, 0, 0.1);
  border-radius: 50%;
  border-top-color: var(--primary-color);
  animation: spin 1s ease-in-out infinite;
}

@keyframes spin {
  to {
    transform: rotate(360deg);
  }
}

/* Error Message Styles */
.error-message {
  color: var(--error-color);
  background-color: rgba(239, 68, 68, 0.1);
  padding: 1rem;
  border-radius: var(--border-radius);
  margin-bottom: 1rem;
  width: 100%;
  text-align: center;
}

/* History Panel Styles */
.history-panel {
  height: fit-content;
}

.history-panel h2 {
  margin-bottom: 1rem;
  font-size: 1.5rem;
  color: var(--primary-color);
}

.empty-history {
  color: #6b7280;
  text-align: center;
  padding: 1rem 0;
}

.history-list {
  display: flex;
  flex-direction: column;
  gap: 1rem;
  max-height: 600px;
  overflow-y: auto;
}

.history-item {
  display: flex;
  gap: 1rem;
  padding: 0.75rem;
  border-radius: var(--border-radius);
  background-color: #f3f4f6;
  cursor: pointer;
  transition: background-color 0.2s;
}

.history-item:hover {
  background-color: #e5e7eb;
}

.history-thumbnail {
  width: 60px;
  height: 60px;
  object-fit: cover;
  border-radius: 4px;
}

.history-item-details {
  flex: 1;
  display: flex;
  flex-direction: column;
  justify-content: space-between;
}

.history-prompt {
  font-size: 0.9rem;
  font-weight: 500;
}

.history-timestamp {
  font-size: 0.8rem;
  color: #6b7280;
}

@media (max-width: 768px) {
  .form-row {
    grid-template-columns: 1fr;
  }
}
```

## 第四步：创建API服务

现在，让我们创建一个服务来处理与AI图像生成API的通信。

创建`src/services/api.js`：

```javascript
import axios from 'axios';

const API_URL = import.meta.env.VITE_API_URL;
const API_KEY = import.meta.env.VITE_API_KEY;

// 使用OpenAI的DALL-E API生成图像
export async function generateImage(prompt, size = '512x512', style = 'vivid') {
  try {
    const response = await axios.post(
      API_URL,
      {
        prompt,
        n: 1,
        size,
        style,
        response_format: 'url',
      },
      {
        headers: {
          'Content-Type': 'application/json',
          'Authorization': `Bearer ${API_KEY}`,
        },
      }
    );

    return {
      url: response.data.data[0].url,
      created: response.data.created,
    };
  } catch (error) {
    console.error('Error generating image:', error.response?.data || error.message);
    throw new Error(error.response?.data?.error?.message || '生成图像时出错');
  }
}

// 如果你想使用Stability AI的API，可以取消注释下面的代码
/*
export async function generateImageWithStabilityAI(prompt, size = '512x512') {
  const [width, height] = size.split('x').map(Number);
  
  try {
    const response = await axios.post(
      'https://api.stability.ai/v1/generation/stable-diffusion-v1-5/text-to-image',
      {
        text_prompts: [{ text: prompt }],
        cfg_scale: 7,
        height,
        width,
        samples: 1,
        steps: 30,
      },
      {
        headers: {
          'Content-Type': 'application/json',
          'Accept': 'application/json',
          'Authorization': `Bearer ${API_KEY}`,
        },
      }
    );

    // 将base64图像转换为URL
    const base64Image = response.data.artifacts[0].base64;
    const imageUrl = `data:image/png;base64,${base64Image}`;
    
    return {
      url: imageUrl,
      created: Date.now(),
    };
  } catch (error) {
    console.error('Error generating image:', error.response?.data || error.message);
    throw new Error(error.response?.data?.message || '生成图像时出错');
  }
}
*/
```

## 第五步：更新主入口文件

更新`src/main.jsx`：

```jsx
import React from 'react';
import ReactDOM from 'react-dom/client';
import App from './App';
import './styles/global.css';
import './styles/components.css';

ReactDOM.createRoot(document.getElementById('root')).render(
  <React.StrictMode>
    <App />
  </React.StrictMode>
);
```

## 第六步：创建工具函数

创建`src/utils/helpers.js`：

```javascript
// 格式化日期时间
export function formatDateTime(timestamp) {
  const date = new Date(timestamp);
  return date.toLocaleString();
}

// 截断文本
export function truncateText(text, maxLength = 50) {
  if (text.length <= maxLength) return text;
  return text.substring(0, maxLength) + '...';
}

// 生成随机ID
export function generateId() {
  return Math.random().toString(36).substring(2, 15) + 
         Math.random().toString(36).substring(2, 15);
}

// 保存到本地存储
export function saveToLocalStorage(key, data) {
  localStorage.setItem(key, JSON.stringify(data));
}

// 从本地存储获取
export function getFromLocalStorage(key) {
  const data = localStorage.getItem(key);
  return data ? JSON.parse(data) : null;
}
```

## 第七步：运行和测试应用

1. 启动开发服务器：

```bash
pnpm dev
```

2. 在浏览器中打开应用（通常是 http://localhost:5173）。

3. 测试应用程序：
   - 输入文本提示
   - 选择图像大小和样式
   - 点击"生成图像"按钮
   - 等待图像生成
   - 下载生成的图像
   - 查看生成历史

## 第八步：部署应用

你可以将应用部署到各种平台，如Vercel、Netlify或GitHub Pages。以下是使用Vercel部署的步骤：

1. 安装Vercel CLI：

```bash
pnpm add -g vercel
```

2. 构建应用：

```bash
pnpm build
```

3. 部署到Vercel：

```bash
vercel
```

按照提示完成部署过程。

## 增强功能

完成基本应用后，你可以考虑添加以下增强功能：

1. **用户认证**：添加登录和注册功能，以便用户可以保存他们的生成历史。
2. **高级提示选项**：添加更多选项，如负面提示、生成多个变体等。
3. **图像编辑**：添加基本的图像编辑功能，如裁剪、调整亮度/对比度等。
4. **社区分享**：允许用户分享他们生成的图像到社交媒体或应用内社区。
5. **提示模板**：提供预设的提示模板，帮助用户生成更好的图像。
6. **暗黑模式**：添加暗黑模式支持。

## 常见问题

### 如何获取API密钥？

要使用OpenAI的DALL-E API，你需要：
1. 创建一个OpenAI账户：https://platform.openai.com/signup
2. 导航到API密钥页面：https://platform.openai.com/api-keys
3. 创建一个新的API密钥
4. 将API密钥添加到你的`.env`文件中

### 如何处理API使用限制和费用？

AI图像生成API通常有使用限制和相关费用。确保：
1. 了解API提供商的定价模型
2. 实现速率限制以避免意外费用
3. 考虑为应用添加用量跟踪和限制功能

### 如何提高图像质量？

要提高生成的图像质量：
1. 使用详细和具体的提示
2. 尝试不同的图像大小和样式设置
3. 使用提示工程技术，如添加艺术风格描述、照明细节等

### 应用加载很慢，如何优化性能？

优化应用性能：
1. 实现图像懒加载
2. 优化组件渲染
3. 使用图像压缩
4. 考虑使用缓存策略

## 总结

在本教程中，我们构建了一个功能齐全的AI图像生成应用。我们学习了如何：
- 设置React项目
- 与AI图像生成API交互
- 处理异步操作和加载状态
- 创建响应式用户界面
- 实现图像下载和历史记录功能

这个项目为你提供了一个坚实的基础，你可以在此基础上添加更多功能，创建更复杂的AI驱动应用程序。 